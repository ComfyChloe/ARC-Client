<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ARC-OSC Client</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="app-container">
        <div class="sidebar">
            <div class="sidebar-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h3>Connection Status</h3>
                    <button class="theme-toggle" id="theme-toggle" onclick="toggleTheme()" title="Toggle Light/Dark Mode">
                        <span class="theme-toggle-sun">â˜€</span>
                        <span class="theme-toggle-moon">ðŸŒ™</span>
                    </button>
                </div>
                <div class="connection-status">
                    <span class="status-indicator status-disconnected" id="server-status"></span>
                    <span id="server-status-text">Disconnected</span>
                </div>
                <div class="connection-status">
                    <span class="status-indicator status-disconnected" id="osc-status"></span>
                    <span id="osc-status-text">OSC Status: Off</span>
                </div>
                <div class="connection-status">
                    <span class="status-indicator status-disconnected" id="ws-forwarding-status"></span>
                    <span id="ws-forwarding-status-text">ARC Server Transmit: Off</span>
                </div>
                <button class="btn btn-primary" id="osc-toggle-btn" onclick="toggleOscServer()" style="width: 100%; margin-top: 10px;">Enable OSC</button>
                <button class="btn btn-primary" id="ws-forwarding-toggle-btn" onclick="toggleWebSocketForwarding()" style="width: 100%; margin-top: 10px;">Enable ARC Server Transmit</button>
            </div>
            <div class="sidebar-section navigation-section">
                <h3>Navigation</h3>
                <button class="btn btn-primary" id="nav-main" onclick="showMainView()" style="width: 100%; margin-bottom: 10px;">Main View</button>
                <button class="btn btn-primary" id="nav-osc" onclick="showOscView()" style="width: 100%; margin-bottom: 10px;">OSC</button>
                <div class="tree-item" style="margin-bottom: 10px;">
                    <button class="tree-toggle" id="nav-extras" style="text-align: center; width: 100%; justify-content: center; display: flex; align-items: center;">
                        <span class="arrow">â–¶</span>
                        <span style="margin: 0;">Extras</span>
                    </button>
                    <div class="tree-content">
                        <div class="tree-items">
                            <button class="tree-child" id="nav-Hyperate" onclick="showHyperateView()">Hyperate</button>
                            <button class="tree-child" id="nav-vosk" onclick="showVOSKView()">VOSK</button>
                        </div>
                    </div>
                </div>
                <button class="btn btn-primary" id="nav-logs" onclick="showLogsView()" style="width: 100%; margin-bottom: 10px;">Logs</button>
                <button class="btn btn-primary" id="nav-settings" onclick="showSettingsView()" style="width: 100%;">Settings</button>
            </div>
            <div class="sidebar-section" id="avatar-section" style="display: none;">
                <h3>Avatar - (Server Side)</h3>
                <div class="avatar-info" id="avatar-info">
                    <div id="avatar-name" style="font-weight: bold; margin-bottom: 5px;">No avatar detected</div>
                    <div id="avatar-id" style="font-size: 0.85em; color: #bdc3c7; word-break: break-all;">ID: Not available</div>
                </div>
                <button class="btn btn-warning" id="avatar-unload-btn" onclick="unloadAvatar()" style="width: 100%; margin-top: 10px; display: none;">Unload Avatar</button>
            </div>
            <div class="sidebar-section" id="auth-section">
                <h3>Authentication</h3>
                <div class="form-group">
                    <div style="margin-bottom: 5px; font-weight: bold; color: #ecf0f1;">Username</div>
                    <input type="text" id="username" value="">
                </div>
                <div class="form-group">
                    <div style="margin-bottom: 5px; font-weight: bold; color: #ecf0f1;">Password</div>
                    <input type="password" id="password" value="">
                </div>
                <button class="btn btn-success" onclick="authenticate()" id="auth-btn">Connect & Login</button>
            </div>
        </div>
        <div class="main-content view-transition" id="main-view">
            <div class="header">
                <h1>ARC-OSC Client</h1>
                <p>Real-time OSC communication with VRChat</p>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="showTab('parameters')">Parameters</button>
            </div>
            
            <div id="parameters" class="tab-content active">
                <div class="card">
                    <h3>Avatar Parameters</h3>
                    <div class="parameter-list" id="parameter-list">
                        <p>Connect and authenticate to view parameters</p>
                    </div>
                </div>
            </div>
        </div>
        <div class="main-content view-transition" id="settings-view" style="display: none;">
            <div class="header">
                <h1>Settings</h1>
                <p>Configure your ARC-OSC Client settings</p>
            </div>
            <div class="card">
                <h3>Server Configuration</h3>
                <div class="form-group">
                    <label>Quick Server Selection</label>
                    <div style="display: flex; gap: 10px; margin-bottom: 15px; flex-wrap: wrap;">
                        <button id="server-btn-live" class="btn btn-primary" onclick="switchToServer('live')" style="flex: 1; min-width: 120px;">ARC-Live</button>
                        <button id="server-btn-beta" class="btn btn-secondary" onclick="switchToServer('beta')" style="flex: 1; min-width: 120px;">ARC-Beta</button>
                        <button id="server-btn-custom" class="btn btn-warning" onclick="switchToServer('custom')" style="flex: 1; min-width: 120px;">Custom (Dev)</button>
                    </div>
                    <div id="current-server-status" class="server-status-box" style="padding: 8px; background-color: #f8f9fa; border-radius: 4px; border-left: 4px solid #3498db; margin-bottom: 10px; font-size: 0.9em;">
                        <strong>Current Server:</strong> <span id="current-server-name">ARC-Live</span>
                    </div>
                </div>
                <div class="form-group">
                    <label for="server-url-settings">WebSocket Server URL</label>
                    <input type="text" id="server-url-settings" value="wss://avatar.comfychloe.uk:48255">
                </div>
                <button class="btn btn-primary" onclick="updateConfigFromSettings()">Update Server Config</button>
            </div>
            <div class="card">
                <h3>Application Settings</h3>
                <div class="form-group">
                    <label for="auto-connect">Auto-connect on startup</label>
                    <select id="auto-connect">
                        <option value="false">Disabled</option>
                        <option value="true">Enabled</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="enable-osc-startup">Enable OSC on startup</label>
                    <select id="enable-osc-startup">
                        <option value="false">Disabled</option>
                        <option value="true">Enabled</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="log-level">Log Level</label>
                    <select id="log-level">
                        <option value="info">Info</option>
                        <option value="warning">Warning</option>
                        <option value="error">Error</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="enable-osc-logging">Enable OSC Data Logging</label>
                    <select id="enable-osc-logging">
                        <option value="false">Disabled (Recommended for Performance)</option>
                        <option value="true">Enabled</option>
                    </select>
                    <small style="color: #666; font-size: 0.85em; margin-top: 5px; display: block;">
                        Disabling OSC logging significantly reduces disk I/O and improves performance
                    </small>
                </div>
                <button class="btn btn-primary" onclick="updateAppSettings()">Update Application Settings</button>
            </div>
        </div>
        <div class="main-content view-transition" id="vosk-view" style="display: none;">
            <div class="header">
                <h1>VOSK Voice Recognition</h1>
                <p>Coming soon - Voice recognition for Universal control</p>
            </div>
            <div class="card">
                <h3>Feature Not Available</h3>
                <p style="color: #666; text-align: center; padding: 20px;">
                    This feature is planned for development and will be available in the future.
                </p>
            </div>
        </div>

        <div class="main-content view-transition" id="Hyperate-view" style="display: none;">
            <div class="header">
                <h1>Hyperate intergration</h1>
                <p>Feature Not Available (yet)</p>
            </div>
            <div class="card">
                <h3>Feature Not Available</h3>
                <p style="color: #666; text-align: center; padding: 20px;">
                    This feature is currently in development and will be available in a future update.
                </p>
            </div>
        </div>

        <div class="main-content view-transition" id="logs-view" style="display: none;">
            <div class="header">
                <h1>Logs</h1>
                <p>View application logs and activity</p>
            </div>
            <div class="card osc-logging-status-box" style="margin-bottom: 10px; padding: 10px; background-color: #f8f9fa; border-left: 4px solid #17a2b8;">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <div>
                        <strong>OSC Data Logging Status:</strong> 
                        <span id="osc-logging-status" style="font-weight: bold;">Enabled</span>
                        <br>
                        <small style="color: #666;">
                            Disable OSC logging in Settings to reduce disk I/O and improve performance
                        </small>
                    </div>
                    <button class="btn btn-warning" onclick="toggleOscLoggingQuick()" id="osc-logging-toggle-btn" style="padding: 6px 12px; font-size: 12px;">
                        Disable OSC Logging
                    </button>
                </div>
            </div>
            <div class="card">
                <h3>Client Logs</h3>
                <div class="log-container" id="client-log-container">
                    Welcome to ARC-OSC Client<br>
                    Configure your settings and connect to get started<br>
                </div>
                <button class="btn btn-primary" onclick="clearClientLogs()" style="margin-top: 10px;">Clear Client Logs</button>
            </div>
            <div class="card">
                <h3>OSC Received</h3>
                <div class="log-container" id="osc-received-log-container">
                    No OSC data received yet<br>
                </div>
                <button class="btn btn-primary" onclick="clearOscReceivedLogs()" style="margin-top: 10px;">Clear OSC Received</button>
            </div>
            <div class="card">
                <h3>OSC Received (from ARC Server)</h3>
                <div class="log-container" id="osc-arc-received-log-container">
                    No OSC data received from ARC Server yet<br>
                </div>
                <button class="btn btn-primary" onclick="clearOscArcReceivedLogs()" style="margin-top: 10px;">Clear OSC from ARC</button>
            </div>
            <div class="card">
                <h3>OSC Forwarded (to ARC Server)</h3>
                <div class="log-container" id="osc-forwarded-log-container">
                    No OSC data forwarded yet<br>
                </div>
                <button class="btn btn-primary" onclick="clearOscForwardedLogs()" style="margin-top: 10px;">Clear OSC Forwarded</button>
            </div>
        </div>
        <div class="main-content view-transition" id="osc-view" style="display: none;">
            <div class="header">
                <h1>OSC Settings</h1>
                <p>Configure and test OSC communication</p>
            </div>
            <div class="card">
                <h3>Send OSC Message</h3>
                <div class="osc-sender">
                    <div class="form-group">
                        <label for="osc-address">Address</label>
                        <input type="text" id="osc-address" placeholder="/avatar/parameters/example">
                    </div>
                    <div class="form-group">
                        <label for="osc-value">Value</label>
                        <input type="text" id="osc-value" placeholder="1.0">
                    </div>
                    <div class="form-group">
                        <label for="osc-type">Type</label>
                        <select id="osc-type">
                            <option value="float">Float</option>
                            <option value="int">Int</option>
                            <option value="bool">Bool</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" onclick="sendOscMessage()">Send</button>
                </div>
            </div>
            <div class="card">
                <h3>OSC Configuration</h3>
                <div class="form-group">
                    <label for="local-port-settings">Primary Incoming OSC Port</label>
                    <input type="number" id="local-port-settings" value="9001" placeholder="Local OSC Port (Incoming)">
                </div>
                <div class="form-group">
                    <label for="target-port-settings">Primary Outgoing OSC Port</label>
                    <input type="number" id="target-port-settings" value="9000" placeholder="Target OSC Port (Outgoing)">
                </div>
                <div class="form-group">
                    <label for="target-address-settings">Local OSC IP Address</label>
                    <input type="text" id="target-address-settings" value="127.0.0.1">
                </div>
                <button class="btn btn-primary" onclick="updateOscPortsFromSettings()" style="margin-top: 15px;">Update Primary OSC Configuration</button>
            </div>

            <div class="card">
                <h3>Additional OSC Connections</h3>
                <p style="margin-bottom: 15px; color: #666; font-size: 0.9em;">
                    Configure additional OSC endpoints for advanced routing. Create separate incoming connections to receive OSC data from multiple sources, 
                    and outgoing connections to send data to multiple applications.
                </p>
                <div class="osc-connection-controls" style="margin-bottom: 20px; padding: 15px; background-color: #f8f9fa; border-radius: 5px; border: 1px solid #dee2e6;">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
                        <div>
                            <button class="btn btn-success" onclick="addOscConnection('incoming')" id="add-incoming-btn" style="margin-right: 10px;">+ Add Incoming</button>
                            <button class="btn btn-success" onclick="addOscConnection('outgoing')" id="add-outgoing-btn" style="margin-right: 10px;">+ Add Outgoing</button>
                        </div>
                        <div style="display: flex; align-items: center; gap: 15px;">
                            <span id="connection-count" style="color: #666; font-size: 0.9em;">0/20 additional connections</span>
                        </div>
                    </div>
                </div>

                <div id="additional-osc-connections">
                    <!-- Dynamic connections -->
                </div>
            </div>
            <div class="card">
                <h3>Parameter Blacklist</h3>
                <p style="margin-bottom: 15px; color: #666; font-size: 0.9em;">
                    Block excessive parameters from being sent to the ARC server.
                </p>
                <p>Use * as a wildcard (e.g., /avatar/parameters/Hue/* to block all parameters after /avatar/parameters/Hue/).
                </p><br>
                <p>View the Logs section of the app and check what data is being sent in excess to ARC and consider blacklisting those parameters.
                </p><br>
                <div class="form-group">
                    <label for="blacklist-pattern">Parameter Pattern</label>
                    <div style="display: flex; gap: 10px;">
                        <input type="text" id="blacklist-pattern" placeholder="/avatar/parameters/FT*" style="flex: 1;">
                        <button class="btn btn-success" onclick="addBlacklistPattern()">Add Pattern</button>
                    </div>
                </div>
                <div id="blacklist-patterns" style="margin-top: 15px;">
                    <!-- Blacklist patterns -->
                </div>
            </div>
        </div>
    </div>
    <script src="app.js"></script>
</body>
</html>